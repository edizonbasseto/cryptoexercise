#
# This file, project or its parts can not be copied and/or distributed without
# the express permission of Edizon Basseto Jr.
#
# @file: CMakeLists.pistache.txt
# @Date: Tuesday, 5th March 2019
# @author: Edizon Basseto Jr (edizon.basseto@outlook.com.br>)
#

#------------------

set(PISTACHE_ROOT  ${CMAKE_CURRENT_SOURCE_DIR}/3pp/pistache)

if(NOT DEFINED CMAKE_INSTALL_PREFIX)
    set(CMAKE_REFRESH "true")
    set(CMAKE_INSTALL_PREFIX "/usr/local")
endif()
string(REGEX REPLACE "/$" "" CMAKE_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}")


include(ProcessorCount)
ProcessorCount(ThreadNum)
set(MAKE_ARGS)
if(NOT N EQUAL 0)
    set(MAKE_ARGS -j${ThreadNum})
endif()

set(BYPRODUCT ${CMAKE_STATIC_LIBRARY_PREFIX}pistache${CMAKE_STATIC_LIBRARY_SUFFIX})

ExternalProject_Add(pistache_lib
    SOURCE_DIR ${PISTACHE_ROOT}
    BUILD_IN_SOURCE TRUE
    CONFIGURE_COMMAND ""
    COMMAND cmake ${PISTACHE_ROOT}
    INSTALL_COMMAND make install ${MAKE_ARGS}
    BUILD_BYPRODUCTS ${CRYPTOPP_ROOT}/${BYPRODUCT})


add_library(pistache STATIC IMPORTED)
include_directories(${PISTACHE_ROOT}/include)

set_property(TARGET pistache PROPERTY IMPORTED_LOCATION "${CMAKE_INSTALL_PREFIX}/lib/libpistache.a")

add_dependencies(pistache pistache_lib)

if(CMAKE_REFRESH)
    unset(CMAKE_INSTALL_PREFIX)
endif()


unset(BYPRODUCT)
unset(PISTACHE_ROOT)
unset(ThreadNum)
unset(MAKE_ARGS)
#------------------
#########################


#/usr/local/lib/libpistache.a